<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Payment</title>
    <link rel="stylesheet" href="../assets/css/coursePayment.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,400;0,500;0,600;0,700;0,800;0,900;1,600&family=Tilt+Neon&display=swap" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="navbar">
            <img class="nav-logo" src="../assets/images/Screenshot 2023-02-11 021952.png" alt="">
            <input class="search" list="search" type="text" placeholder="Search for courses,videos & Blogs">
            <datalist id="search">
                <option value="warren buffett in anual letter,stays upbeat......">
                <option value="tesla elon musk fans tout cybertruck demand......">
                <option value="how to buy a stock and make your money four......">
                <option value="Dow Jones falters on hot inflation boeing groundened......">
                <option value="What's going on microsoft and between apple shares......">
                <option value="Big Tech hits $1.5 trillion in sales last year......">
                <option value="Sirius XM (SIRI) and Toyoto collaborate to celebrate......">
                <option value="Futures fall ahead of key inflation report investor's......">
                <option value="Netflix lands first partnership with NFL: how patrick......">
                <option value="Whatsapp to bring i-Message-like-feature to android and iPhone......">
            </datalist>
            <div class="notification">
              &emsp;&emsp;&emsp; <img class="notificationimg" onclick="profile1()" src="../assets/images/icons8-notification-50.png" alt="notification-img">
            </div>
            <div class="notification">
                <div class="dropdown">
                <img class="notificationimg" onclick="profile1()" src="../assets/images/icons8-translator-50.png" alt="translator-img">
                <div class="dropdown-content-lang"><br>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; English </a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; France</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Italy</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Arabic</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Espanol</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Algeria</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Albania</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Japanese</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Hindi</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Tamil</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Portuguese</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Spanish</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Russian</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; German</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Korean</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Telugu</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Turkish</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Ukranian</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Malayalam</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Kannada</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="translator-img" />&nbsp; Chinese</a><br>
                    </div>
                    </div>
            </div>
            <div class="notification">
                <div class="dropdown">
                <img class="notificationimg" onclick="profile1()" src="../assets/images/icons8-online-support-50.png" alt="support-img">
                <div class="dropdown-content"><br>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-group-50.png" alt="connect-img"/>&nbsp; Connect With Us</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-group-message-50.png" alt="chat-img"/>&nbsp; Chat With Us</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-invite-50.png" alt="mail-img"/>&nbsp; Write a Mail</a>
                    <a href="#"><img class="user-dropdown" src="../assets/images/icons8-online-support-50.png" alt="support-img"/>&nbsp; Support Center</a><br>
                    </div>
                    </div>
            </div>
            <div class="notification">
                <div class="dropdown" id="dropuser">
                    
                    <div class="dropdown-content"><br>
                      <a href="userprofile.html"><img class="user-dropdown" src="../assets/images/icons8-group-50.png" alt="icon-accounts-img"/>&nbsp; Accounts</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-logout-rounded-50.png" alt="icon-accounts-img"/>&nbsp; Personal Details</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-invite-50.png" alt="icon-accounts-img"/>&nbsp; Invite & Earn</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-membership-card-30.png" alt="icon-accounts-img"/>&nbsp; Membership</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-light-mode-78.png" alt="icon-accounts-img"/>&nbsp; Appearance : Light</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-translator-50.png" alt="icon-accounts-img"/>&nbsp; Language : English</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-user-location-30.png" alt="icon-accounts-img"/>&nbsp; Location : India</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-gears-30.png" alt="icon-accounts-img"/>&nbsp; Settings</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-online-support-50.png" alt="icon-accounts-img"/>&nbsp; Help</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-group-50.png" alt="icon-accounts-img"/>&nbsp; Send feedback</a>
                      <a href="#"><img class="user-dropdown" src="../assets/images/icons8-logout-rounded-50 (1).png" alt="icon-accounts-img"/>&nbsp; Log Out</a><br>
                    </div>
                  </div>
            </div>

        </div>
        <div class="bread-crumb">
            <div><span class="slash">=></span> <a class="bread-crumb1" href="#">Home</a></div><span class="slash">/</span>
            <div><a class="bread-crumb1" href="#">Dashboard</a></div><span class="slash">/</span>
            <div><a class="bread-crumb1" href="#">Learn</a></div><span class="slash">/</span>
            <div><a class="bread-crumb1" >Payment</a></div>
        </div>
       
    </nav>
    <main>


<!--heropage start-->

<div class="heropage">

    <h1 class="heroh1">PAYMENT PAGE</h1>

    <div class="paymentbody">
        <h1>Payment method</h1>
     
        <div class="paymenttwocontainer">
     <div class="creditcardsideleft">
    
        <div class="creditcarddiv">
            <input type="radio" name="radio" id="radioactive" checked />&nbsp;
            <p class="creditcardpara">Credit card</p>
            <img class="creditcardimg" src="../assets/website images/Screenshot 2022-12-27 162307.png" alt="creditcardimg">
        </div>
        <form action="../thankyou.html">
            
        <p class="creditcardpara">Card number</p>
        <input type="number" name="" value="4232389874898325" id="cardnumber" maxlength="16" placeholder="Enter your 16 digit card number" required/>
    
        <div class="expirydiv">
            <div>
                <p class="creditcardpara">Expiration date</p>
                <select name="year" id="month">
                    <option value="Month">Month</option>
                    <option value="Jan">Jan</option>
                    <option value="Feb">Feb</option>
                    <option value="Mar">Mar</option>
                    <option value="Apr">Apr</option>
                    <option value="May">May</option>
                    <option value="Jun">Jun</option>
                    <option value="Jul">Jul</option>
                    <option value="Aug">Aug</option>
                    <option value="Sep">Sep</option>
                    <option value="Oct">Oct</option>
                    <option value="Nov">Nov</option>
                    <option value="Dec">Dec</option>
                    </select>
            </div>
            <div>
                <select name="year" id="year">
                <option value="Year">Year</option>
                <option value="2023">2023</option>
                <option value="2024">2024</option>
                <option value="2025">2025</option>
                <option value="2026">2026</option>
                </select>
            </div>
            <div>
                <p class="creditcardpara">Security code</p>
                <input type="password" name="securitycode" id="securitycode" value="383" placeholder="three digits cvv" maxlength="3" required/>
            </div>
        </div>
    
        <p class="termsandconditions">By clicking the button,you agree to the Terms and Conditions</p>
    
        <button id="paybtn" class="paybtn">Pay Now</button>
     </form>
    </div>
    
    <div class="creditrightdiv">
    
        <div  class="creditcarddiv2">
              <input type="radio" name="radio" id="radioactive" >&nbsp;
            <p class="creditcardpara">Paypal</p>
              <img class="creditcardimg" src="../assets/website images/Screenshot 2022-12-27 162307.png" alt="creditcardimg">
        </div>
    <br>
        <div  class="creditcarddiv2">
              <input type="radio" name="radio" id="radioactive" >&nbsp;
            <p class="creditcardpara">UPI</p>
              <img class="creditcardimg" src="../assets/website images/Screenshot 2022-12-27 162307.png" alt="creditcardimg">
        </div>
    <br>
        <div  class="creditcarddiv2">
              <input type="radio" name="radio" id="radioactive" >&nbsp;
            <p class="creditcardpara">Google Pay</p>
              <img class="creditcardimg" src="../assets/website images/Screenshot 2022-12-27 162307.png" alt="creditcardimg">
        </div>
    <br>
        <div  class="creditcarddiv2">
              <input type="radio" name="radio" id="radioactive" >&nbsp;
            <p class="creditcardpara">Phonepe</p>
              <img class="creditcardimg" src="../assets/website images/Screenshot 2022-12-27 162307.png" alt="creditcardimg">
        </div>
    
    </div>
    </div>
    
    </div>




































</main>


<script>
    const register_arr = JSON.parse(localStorage.getItem("register_arr"));
    console.log(register_arr);

    const login_arr = JSON.parse(localStorage.getItem("login_arr"));
    console.log(login_arr);

    const get_obj = register_arr.find( event => event.email === login_arr);
    console.log(get_obj);
     

      let user_profile;


      user_profile = document.createElement("img");
      user_profile.setAttribute("id","user-profile");
      user_profile.setAttribute("class","dropbtn");
      user_profile.setAttribute("onclick","profile()");
      user_profile.setAttribute("src", get_obj["profile_pic"]);
      document.querySelector("#dropuser").prepend(user_profile);


         //payment add course 

      const course_data = JSON.parse(localStorage.getItem("course_data"));
     console.log(course_data);

     const mycourses = JSON.parse(localStorage.getItem("add-to-card"));
     console.log(mycourses);

     const url = window.location.search;
     const urlParams = new URLSearchParams(url);
     const username = urlParams.get("name");
     console.log(username);

     const get_course_obj = course_data.find((event) => event.title === username );
     console.log(get_course_obj["id"]);





      const pay_btn = document.getElementById("paybtn");
      pay_btn.addEventListener("click", (event) => {
      event.preventDefault();



      let register = JSON.parse(localStorage.getItem("register_arr"));


let loggin = JSON.parse(localStorage.getItem("login_arr"));
        console.log(loggin);

const get_user_obj = register.find((event) => event.email === loggin);
        console.log(get_user_obj);

let index = register.indexOf(get_user_obj);
console.log(index);

    //   let payment_arr = [];
    const mycourses = JSON.parse(localStorage.getItem("add-to-card"));



// const mycourses = JSON.parse(localStorage.getItem("add-to-card"));

//   //after course payment it is added to user mycourses
//       if( register[index].courses != null ) {   
 
//  let courses_id = {
//       "id" : get_course_obj.id,
//  } 

//     //check match is true / false
//     let objMatch = false;
// for(let i=0;i<mycourses.length;i++){
//   for(let j = 0; j < register[index].courses.length ; j++ ){
//   if( mycourses[i]["id"] !== register[index].courses[j]["id"] ){
//     objMatch = true;

//   }
// }

// console.log(objMatch);
// console.log(register[index].courses);
// }

// //checked it should return true

//    if( objMatch === true ){
    
//     alert("this course is already purchased by you");
//     //skip this part
//    } else {
//     register[index].courses.push(courses_id);
//     localStorage.setItem("register_arr",JSON.stringify(register));
//    } 

// } else {

// let course_obj = [];

// let courses_id = {
//       "id" : get_course_obj.id,
//  } 

// course_obj.push(courses_id);
       
// let user_obj = {
// "courses" : course_obj,
// };

// let user_id_assign = Object.assign(get_user_obj,user_obj);
// console.log(user_id_assign);

// let index = register.indexOf(get_user_obj);
// console.log(index);

// register[index] = user_id_assign;

// localStorage.setItem("register_arr",JSON.stringify(register));

// }

      
      if(localStorage.getItem("payment_arr") !== null  ?? [] ){
        payment_arr = JSON.parse(localStorage.getItem("payment_arr"));

        let card_number = document.getElementById("cardnumber").value; 
      let expiry_month = document.getElementById("month").value; 
      let expiry_year = document.getElementById("year").value; 
      let security_code = document.getElementById("securitycode").value; 
      let payment_id = Date.now(); 

     let payment_obj = {
        card_number,expiry_month,expiry_year,security_code,payment_id
     };

     payment_arr.push(payment_obj);

     
                  //email send to User that he bought the course

                  let body = `

                  Thank You For Your Purchase!
                  
                  Dear User,
                  
                  Thank you for purchasing our trading course, [course name]. We're excited to help you learn and grow in your trading journey.
                  
                  You can access your course material by logging in to your account on our website. If you have any questions or issues, please don't hesitate to reach out to us at [support email].
                  
                  Course Image - ${get_obj["img"]}
                  
                  Course Title - ${get_obj["title"]}
                  Course Timing - ${get_obj["timing"]}
                  Course Cost Type - ${get_obj["cost_type"]}
                  Course Cost - ${get_obj["cost"]}
                  Course Old Cost - ${get_obj["old_cost"]}
                  Course Language - ${get_obj["language"]}
                  Course Instructor Name - ${get_obj["instructorname"]}
                  Course Instructor Description - ${get_obj["instructordesc"]}
                  Course Offered Company Name - ${get_obj["offeredcompanyname"]}
                  Course Offered Company Description - ${get_obj["offeredcompanydesc"]}

                  Click the Course Link to Access Now - ${window.location} 
                  
        
                 
                     `;
        
                    
                    let params = {from_name: "freekyajmal@gmail.com",
                    to_name: "freekyajmal@gmail.com",
                    // message: "test",
                    Course_Image:get_obj["img"],
                    Course_title:get_obj["title"],
                    Course_timing:get_obj["timing"],
                    Course_cost_type:get_obj["cost_type"],
                    Course_cost:get_obj["cost"],
                    Course_old_cost:get_obj["old_cost"],
                    Course_language:get_obj["language"],
                    Course_instructor_name:get_obj["instructorname"],
                    Course_instructor_desc:get_obj["instructordesc"],
                    Course_offered_company_name:get_obj["offeredcompanyname"],
                    Course_offered_company_desc:get_obj["offeredcompanydesc"],
                    Course_link: window.location,
                  
                   }
        
        emailjs.send("service_sp6m68x","template_uo2qcla",params)
        .then( message => {
        
           console.log(message)
           
          } )
          .catch(err => console.log(err));



     localStorage.setItem("payment_arr",JSON.stringify(payment_arr));



    //  if( existobj[0] == undefined ){
    //     mycourses.push(get_course_obj);
    //  localStorage.setItem("add-to-card",JSON.stringify(mycourses));
    //  } else {
    //     alert("Course Already Added");
    //     window.location.href = "learn.html";
    //  }
    

      }

      else {

        let payment_arr = [];

        let card_number = document.getElementById("cardnumber").value; 
      let expiry_month = document.getElementById("month").value; 
      let expiry_year = document.getElementById("year").value; 
      let security_code = document.getElementById("securitycode").value; 
      let payment_id = Date.now(); 


     let payment_obj = {
        card_number,expiry_month,expiry_year,security_code,payment_id
     };

     payment_arr.push(payment_obj);


     
                  //email send to User that he bought the course

                  let body = `

                  Thank You For Your Purchase!
                  
                  Dear User,
                  
                  Thank you for purchasing our trading course, [course name]. We're excited to help you learn and grow in your trading journey.
                  
                  You can access your course material by logging in to your account on our website. If you have any questions or issues, please don't hesitate to reach out to us at [support email].
                  
                  Course Image - ${get_obj["img"]}
                  
                  Course Title - ${get_obj["title"]}
                  Course Timing - ${get_obj["timing"]}
                  Course Cost Type - ${get_obj["cost_type"]}
                  Course Cost - ${get_obj["cost"]}
                  Course Old Cost - ${get_obj["old_cost"]}
                  Course Language - ${get_obj["language"]}
                  Course Instructor Name - ${get_obj["instructorname"]}
                  Course Instructor Description - ${get_obj["instructordesc"]}
                  Course Offered Company Name - ${get_obj["offeredcompanyname"]}
                  Course Offered Company Description - ${get_obj["offeredcompanydesc"]}

                  Click the Course Link to Access Now - ${window.location} 
                  
        
                 
                     `;
        
                    
                    let params = {from_name: "freekyajmal@gmail.com",
                    to_name: "freekyajmal@gmail.com",
                    // message: "test",
                    Course_Image:get_obj["img"],
                    Course_title:get_obj["title"],
                    Course_timing:get_obj["timing"],
                    Course_cost_type:get_obj["cost_type"],
                    Course_cost:get_obj["cost"],
                    Course_old_cost:get_obj["old_cost"],
                    Course_language:get_obj["language"],
                    Course_instructor_name:get_obj["instructorname"],
                    Course_instructor_desc:get_obj["instructordesc"],
                    Course_offered_company_name:get_obj["offeredcompanyname"],
                    Course_offered_company_desc:get_obj["offeredcompanydesc"],
                    Course_link: window.location,
                  
                   }
        
        emailjs.send("service_sp6m68x","template_uo2qcla",params)
        .then( message => {
        
           console.log(message)
           
          } )
          .catch(err => console.log(err));



     localStorage.setItem("payment_arr",JSON.stringify(payment_arr));



    //     mycourses.push(get_course_obj);
    //  localStorage.setItem("add-to-card",JSON.stringify(mycourses));
    
    

      }




     //after course payment it is added to user mycourses
     if( register[index].courses != null ) {   
 
 let courses_id = {
      "obj" : get_course_obj,
      "isCoursePurchased" : true,
 } 

    // check match is true / false
//     let objMatch = false;
// for(let i=0;i<mycourses.length;i++){
//   for(let j = 0; j < register[index].courses.length ; j++ ){
//   if( mycourses[i]["id"] !== register[index].courses[j]["id"] ){
//     objMatch = true;

//   }
// }

// console.log(objMatch);
// console.log(register[index].courses);
// }

//checked it should return true
const existobj = register[index].courses.find((event) => event["obj"]["id"] === get_course_obj["id"] );
     console.log(existobj);



   if( existobj === undefined  ){
    
    
    register[index].courses.push(courses_id);
    localStorage.setItem("register_arr",JSON.stringify(register));
    alert("this course is added to mycourses");
    //skip this part
   } else {
    //skip
    alert("this course is already added");
   } 

} else {

let course_obj = [];

let courses_id = {
      "obj" : get_course_obj,
 } 

course_obj.push(courses_id);
       
let user_obj = {
"courses" : course_obj,
};

let user_id_assign = Object.assign(get_user_obj,user_obj);
console.log(user_id_assign);

let index = register.indexOf(get_user_obj);
console.log(index);

register[index] = user_id_assign;

localStorage.setItem("register_arr",JSON.stringify(register));

}




















      window.location.href = "learn.html";


      });
      
   
  //     //payment add course 

  //     const course_data = JSON.parse(localStorage.getItem("course_data"));
  //    console.log(course_data);

  // const url = window.location.search;
  // const urlParams = new URLSearchParams(url);
  // const username = urlParams.get("name");
  // console.log(username);

  // const get_course_obj = course_data.find((event) => event["title"] == username);
  // console.log(get_course_obj);

  // const mycourses = JSON.parse(localStorage.getItem("add-to-card"));
  //    console.log(mycourses);

  //    const existobj = mycourses.find((event) => event.id === get_course_obj.id);
  //    console.log(existobj);


  //     const pay_btn = document.getElementById("paybtn");
  //     pay_btn.addEventListener("click", (event) => {
  //     event.preventDefault();




  //   //   let payment_arr = [];
      
  //     if(localStorage.getItem("payment_arr") !== null ){
  //       payment_arr = JSON.parse(localStorage.getItem("payment_arr"));

  //       let card_number = document.getElementById("cardnumber").value; 
  //     let expiry_month = document.getElementById("month").value; 
  //     let expiry_year = document.getElementById("year").value; 
  //     let security_code = document.getElementById("securitycode").value; 
  //     let payment_id = Date.now(); 

  //    let payment_obj = {
  //       card_number,expiry_month,expiry_year,security_code,payment_id
  //    };

  //    payment_arr.push(payment_obj);

  //    localStorage.setItem("payment_arr",JSON.stringify(payment_arr));

  //    if( existobj != undefined ){
  //       mycourses.push(get_course_obj);
  //    localStorage.setItem("add-to-card",JSON.stringify(mycourses));
  //    } else {
  //       alert("Course Already Added");
  //       window.location.href = "learn.html";
  //    }
    


  //     }

  //     else {

  //       let payment_arr = [];

  //       let card_number = document.getElementById("cardnumber").value; 
  //     let expiry_month = document.getElementById("month").value; 
  //     let expiry_year = document.getElementById("year").value; 
  //     let security_code = document.getElementById("securitycode").value; 
  //     let payment_id = Date.now(); 


  //    let payment_obj = {
  //       card_number,expiry_month,expiry_year,security_code,payment_id
  //    };

  //    payment_arr.push(payment_obj);

  //    localStorage.setItem("payment_arr",JSON.stringify(payment_arr));



  //       mycourses.push(get_course_obj);
  //    localStorage.setItem("add-to-card",JSON.stringify(mycourses));
    
    

  //     }


  //   window.location.href = "learn.html";

  //     });
   
</script>
</body>
</html>